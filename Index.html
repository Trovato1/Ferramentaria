<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ferramentaria</title>
    <link rel="icon" type="image/png" href="Logo_pagina.png">


    <style>
        :root {
            --primary: #0056b3;
            --secondary: #ffd700;
            --dark: #1a1a1a;
            --light: #ffffff;
            --error: #d9534f;
            --success: #28a745;
            --gray: #f8f9fa;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--gray);
            background-image: url(logo_mendes1.png);
            background-size: 70%;
            background-repeat: no-repeat;
            background-position: center;
            color: #212529;
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem;
        }

        header {
            background-color: rgb(193, 221, 230);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 1rem 0;
            margin-bottom: 2rem;
        }

        h1 {
            color: red;
            text-align: center;
            margin-bottom: 1.5rem;
            font-size: 1.8rem;
        }

        nav ul {
            list-style: none;
            padding: 0;
            margin-bottom: 1.5rem;
            text-align: center;
        }

        nav ul li {
            display: inline-block;
            margin: 0 0.5rem;
        }

        nav ul li a {
            color: red;
            text-decoration: none;
            font-weight: 500;
        }

        table th,
        table td {
            font-size: 1.1rem;
            font-weight: 400;
            color: #000;
        }


        .controls {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .search-box {
            flex: 1;
            min-width: 300px;
        }

        .search-box input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 1rem;
        }

        .filters {
            display: flex;
            gap: 1rem;
        }

        .filters select {
            padding: 0.75rem;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 1rem;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background-color: rgba(255, 255, 255, 0.5);
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .stat-card h3 {
            margin-top: 0;
            color: var(--dark);
            font-size: 1rem;
            font-weight: 500;
        }

        .stat-card .value {
            font-size: 2rem;
            font-weight: 700;
            color: red;
            margin: 0.5rem 0;
        }

        .stat-card .subtitle {
            color: #6c757d;
            font-size: 0.9rem;
        }

        .table-container {
            background-color: rgba(255, 255, 255, 0.5);
            backdrop-filter: blur(3px);
            border-radius: 8px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.15);
            overflow: hidden;
            margin-bottom: 2rem;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th,
        td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
        }

        th {
            background-color: #f8f9fa;
            font-weight: 500;
            color: var(--dark);
        }

        tr:hover {
            background-color: #f8f9fa;
        }

        .low-stock {
            color: var(--error);
            font-weight: 500;
        }

        .status-badge {
            display: inline-block;
            padding: 0.35rem 0.7rem;
            border-radius: 12px;
            font-size: 0.9rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border: 1px solid transparent;
        }

        .status-available {
            background-color: rgba(40, 167, 69, 0.15);
            color: #1e7e34;
            border-color: #1e7e34;
        }

        .status-low {
            background-color: rgba(255, 193, 7, 0.2);
            color: #c69500;
            border-color: #c69500;
        }

        .status-out {
            background-color: rgba(220, 53, 69, 0.15);
            color: #b21f2d;
            border-color: #b21f2d;
        }


        .pagination {
            display: flex;
            justify-content: center;
            margin-top: 1.5rem;
            gap: 0.5rem;
        }

        .pagination button {
            padding: 0.5rem 1rem;
            background-color: var(--light);
            border: 1px solid #ced4da;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .pagination button:hover {
            background-color: #e9ecef;
        }

        .pagination button.active {
            background-color: var(--primary);
            color: var(--light);
            border-color: var(--primary);
        }

        .message {
            padding: 0.75rem;
            border-radius: 4px;
            margin-bottom: 1rem;
            text-align: center;
        }

        .success {
            background-color: rgba(40, 167, 69, 0.1);
            border: 1px solid var(--success);
            color: var(--success);
        }

        .error {
            background-color: rgba(217, 83, 79, 0.1);
            border: 1px solid var(--error);
            color: var(--error);
        }

        .hidden {
            display: none;
        }

        .loading {
            text-align: center;
            padding: 2rem;
            color: #6c757d;
        }

        @media (max-width: 768px) {
            .controls {
                flex-direction: column;
            }

            .filters {
                width: 100%;
            }

            .table-container {
                overflow-x: auto;
            }

            table {
                min-width: 700px;
            }
        }
    </style>

    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet" />

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
</head>

<body>
    <header>
        <div class="container">
            <h1>Ferramentaria Mendes Junior</h1>
            <nav>
                <ul>
                    <li><a href="login.html">Gerenciar Produtos</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <div class="container">
        <div id="message" class="message hidden"></div>

        <div class="controls">
            <div class="search-box">
                <input type="text" id="search" placeholder="Pesquisar por código, item ou descrição..." />
            </div>
            <div class="filters">
                <select id="categoryFilter">
                    <option value="">Todas as categorias</option>
                    <option value="pecas">Peças</option>
                    <option value="acessorios">Acessórios</option>
                    <option value="ferramentas">Ferramentas</option>
                    <option value="lubrificantes">Lubrificantes</option>
                </select>
                <select id="statusFilter">
                    <option value="">Todos os status</option>
                    <option value="available">Disponível</option>
                    <option value="low">Estoque Baixo</option>
                    <option value="out">Sem Estoque</option>
                </select>
            </div>
        </div>

        <div class="stats">
            <div class="stat-card">
                <h3>Total de Itens</h3>
                <div class="value" id="totalItems">0</div>
                <div class="subtitle">No estoque</div>
            </div>
            <div class="stat-card">
                <h3>Valor Total</h3>
                <div class="value" id="totalValue">R$ 0,00</div>
                <div class="subtitle">Em estoque</div>
            </div>
            <div class="stat-card">
                <h3>Itens com Estoque Baixo</h3>
                <div class="value" id="lowStockItems">0</div>
                <div class="subtitle">Precisam de reposição</div>
            </div>
            <div class="stat-card">
                <h3>Última Atualização</h3>
                <div class="value" id="lastUpdate">-</div>
                <div class="subtitle">Do estoque</div>
            </div>
        </div>

        <div class="table-container">
            <table id="inventoryTable">
                <thead>
                    <tr>
                        <th>Código</th>
                        <th>Item</th>
                        <th>Descrição</th>
                        <th>Categoria</th>
                        <th>Quantidade</th>
                        <th>Preço Unit.</th>
                        <th>Valor Total</th>
                        <th>Última Leva</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                    <tr>
                        <td colspan="9" class="loading" id="loadingMessage">Carregando dados do estoque...</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="pagination" id="pagination">
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDk4G22OBWTsF_kHqlLSqKD3qMqGXH4ct8",
            authDomain: "sorteio-fc2fd.firebaseapp.com",
            databaseURL: "https://sorteio-fc2fd-default-rtdb.firebaseio.com",
            projectId: "sorteio-fc2fd",
            storageBucket: "sorteio-fc2fd.appspot.com",
            messagingSenderId: "1066746842685",
            appId: "1:1066746842685:web:3d8d7b6d4b8c4f8e9c5a7c"
        };

        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        const tableBody = document.getElementById('tableBody');
        const searchInput = document.getElementById('search');
        const categoryFilter = document.getElementById('categoryFilter');
        const statusFilter = document.getElementById('statusFilter');
        const paginationContainer = document.getElementById('pagination');
        const totalItemsElement = document.getElementById('totalItems');
        const totalValueElement = document.getElementById('totalValue');
        const lowStockItemsElement = document.getElementById('lowStockItems');
        const lastUpdateElement = document.getElementById('lastUpdate');
        const loadingMessage = document.getElementById('loadingMessage');

        let currentPage = 1;
        const itemsPerPage = 8;
        let inventoryData = [];
        let filteredData = [];

        document.addEventListener('DOMContentLoaded', function () {
            loadInventoryData();
            setupEventListeners();
        });

        function loadInventoryData() {
            loadingMessage.style.display = 'table-cell';

            database.ref('estoque').once('value')
                .then((snapshot) => {
                    const data = snapshot.val();
                    if (data) {
                        inventoryData = Object.keys(data).map(key => {
                            return {
                                id: key,
                                ...data[key]
                            };
                        });
                    } else {
                        inventoryData = [];
                        initializeSampleData();
                    }

                    filteredData = [...inventoryData];
                    updateStats();
                    renderTable();
                    updateLastUpdate();
                    loadingMessage.style.display = 'none';
                })
                .catch((error) => {
                    console.error('Erro ao carregar dados:', error);
                    showMessage('Erro ao carregar dados do estoque.', 'error');
                    loadingMessage.textContent = 'Erro ao carregar dados';
                });
        }

        function initializeSampleData() {
            const sampleData = [
                {
                    code: "P001",
                    name: "Filtro de Óleo",
                    description: "Filtro de óleo para motor 1.0",
                    category: "pecas",
                    quantity: 45,
                    minQuantity: 20,
                    price: 24.90,
                    lastArrival: "15/03/2023",
                    createdAt: new Date().toISOString()
                },
                {
                    code: "P002",
                    name: "Pastilha de Freio",
                    description: "Pastilha de freio dianteira",
                    category: "pecas",
                    quantity: 12,
                    minQuantity: 15,
                    price: 89.90,
                    lastArrival: "22/03/2023",
                    createdAt: new Date().toISOString()
                },
                {
                    code: "A001",
                    name: "Capa de Banco",
                    description: "Capa universal para bancos dianteiros",
                    category: "acessorios",
                    quantity: 8,
                    minQuantity: 10,
                    price: 129.90,
                    lastArrival: "10/03/2023",
                    createdAt: new Date().toISOString()
                }
            ];

            const updates = {};
            sampleData.forEach((item, index) => {
                const newKey = database.ref('estoque').push().key;
                updates[`estoque/${newKey}`] = item;
            });

            database.ref().update(updates)
                .then(() => {
                    loadInventoryData(); // Recarregar dados após inserção
                })
                .catch((error) => {
                    console.error('Erro ao inicializar dados:', error);
                });
        }

        function setupEventListeners() {
            searchInput.addEventListener('input', handleSearch);
            categoryFilter.addEventListener('change', handleFilter);
            statusFilter.addEventListener('change', handleFilter);

            database.ref('estoque').on('value', (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    inventoryData = Object.keys(data).map(key => {
                        return {
                            id: key,
                            ...data[key]
                        };
                    });
                    filteredData = [...inventoryData];
                    updateStats();
                    renderTable();
                    updateLastUpdate();
                }
            });
        }

        function updateStats() {
            const totalItems = inventoryData.reduce((sum, item) => sum + item.quantity, 0);
            const totalValue = inventoryData.reduce((sum, item) => sum + (item.quantity * item.price), 0);
            const lowStockItems = inventoryData.filter(item => item.quantity > 0 && item.quantity <= item.minQuantity).length;

            totalItemsElement.textContent = totalItems;
            totalValueElement.textContent = `R$ ${totalValue.toFixed(2).replace('.', ',')}`;
            lowStockItemsElement.textContent = lowStockItems;
        }

        function updateLastUpdate() {
            const now = new Date();
            const formattedDate = now.toLocaleDateString('pt-BR') + ' ' + now.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
            lastUpdateElement.textContent = formattedDate;
        }

        function handleSearch() {
            const searchTerm = searchInput.value.toLowerCase();
            filterData();
            currentPage = 1;
            renderTable();
        }

        function handleFilter() {
            filterData();
            currentPage = 1;
            renderTable();
        }

        function filterData() {
            const searchTerm = searchInput.value.toLowerCase();
            const categoryValue = categoryFilter.value;
            const statusValue = statusFilter.value;

            filteredData = inventoryData.filter(item => {
                const matchesSearch = !searchTerm ||
                    item.code.toLowerCase().includes(searchTerm) ||
                    item.name.toLowerCase().includes(searchTerm) ||
                    item.description.toLowerCase().includes(searchTerm);

                const matchesCategory = !categoryValue || item.category === categoryValue;

                let matchesStatus = true;
                if (statusValue === 'available') {
                    matchesStatus = item.quantity > item.minQuantity;
                } else if (statusValue === 'low') {
                    matchesStatus = item.quantity > 0 && item.quantity <= item.minQuantity;
                } else if (statusValue === 'out') {
                    matchesStatus = item.quantity === 0;
                }

                return matchesSearch && matchesCategory && matchesStatus;
            });
        }

        function renderTable() {
            tableBody.innerHTML = '';

            if (filteredData.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `<td colspan="9" class="loading">Nenhum produto encontrado</td>`;
                tableBody.appendChild(row);
                paginationContainer.innerHTML = '';
                return;
            }

            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const paginatedData = filteredData.slice(startIndex, endIndex);

            paginatedData.forEach(item => {
                const row = document.createElement('tr');

                let statusClass = '';
                let statusText = '';
                if (item.quantity === 0) {
                    statusClass = 'status-out';
                    statusText = 'Sem Estoque';
                } else if (item.quantity <= item.minQuantity) {
                    statusClass = 'status-low';
                    statusText = 'Estoque Baixo';
                } else {
                    statusClass = 'status-available';
                    statusText = 'Disponível';
                }

                const totalValue = (item.quantity * item.price).toFixed(2).replace('.', ',');
                const unitPrice = item.price.toFixed(2).replace('.', ',');

                row.innerHTML = `
                    <td>${item.code}</td>
                    <td>${item.name}</td>
                    <td>${item.description}</td>
                    <td>${formatCategory(item.category)}</td>
                    <td class="${item.quantity <= item.minQuantity ? 'low-stock' : ''}">${item.quantity}</td>
                    <td>R$ ${unitPrice}</td>
                    <td>R$ ${totalValue}</td>
                    <td>${item.lastArrival}</td>
                    <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                `;

                tableBody.appendChild(row);
            });

            renderPagination();
        }

        function formatCategory(category) {
            const categories = {
                'pecas': 'Peças',
                'acessorios': 'Acessórios',
                'ferramentas': 'Ferramentas',
                'lubrificantes': 'Lubrificantes'
            };
            return categories[category] || category;
        }

        function renderPagination() {
            const totalPages = Math.ceil(filteredData.length / itemsPerPage);

            paginationContainer.innerHTML = '';

            if (totalPages <= 1) return;

            const prevButton = document.createElement('button');
            prevButton.innerHTML = '&laquo;';
            prevButton.disabled = currentPage === 1;
            prevButton.addEventListener('click', () => {
                if (currentPage > 1) {
                    currentPage--;
                    renderTable();
                }
            });
            paginationContainer.appendChild(prevButton);

            for (let i = 1; i <= totalPages; i++) {
                const pageButton = document.createElement('button');
                pageButton.textContent = i;
                pageButton.classList.toggle('active', i === currentPage);
                pageButton.addEventListener('click', () => {
                    currentPage = i;
                    renderTable();
                });
                paginationContainer.appendChild(pageButton);
            }

            const nextButton = document.createElement('button');
            nextButton.innerHTML = '&raquo;';
            nextButton.disabled = currentPage === totalPages;
            nextButton.addEventListener('click', () => {
                if (currentPage < totalPages) {
                    currentPage++;
                    renderTable();
                }
            });
            paginationContainer.appendChild(nextButton);
        }

        function showMessage(text, type) {
            const messageDiv = document.getElementById('message');
            messageDiv.textContent = text;
            messageDiv.className = `message ${type}`;
            messageDiv.classList.remove('hidden');

            setTimeout(() => {
                messageDiv.classList.add('hidden');
            }, 5000);
        }
    </script>
</body>

</html>